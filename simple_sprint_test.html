<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Sprint Test</title>
    <link rel="stylesheet" href="styles.css">
    <script src="app.js"></script>
</head>
<body>
    <div class="container">
        <h1>Simple Sprint Test</h1>
        
        <div class="test-section">
            <h2>Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Current View</h2>
            <div id="current-view"></div>
        </div>
        
        <div class="test-section">
            <h2>Sprint Board</h2>
            <div id="sprint-board"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const app = window.app;
            
            function addResult(message, success = true) {
                const resultsDiv = document.getElementById('test-results');
                const resultClass = success ? 'success' : 'error';
                resultsDiv.innerHTML += `<div class="result ${resultClass}">${message}</div>`;
                console.log(message);
            }
            
            function updateCurrentView() {
                const viewDiv = document.getElementById('current-view');
                viewDiv.innerHTML = `
                    <h3>Current View: ${app.currentView}</h3>
                    <p>Current Sprint: ${app.currentSprint ? app.currentSprint.name : 'None'}</p>
                    <p>Sprint Selector: ${document.getElementById('sprint-selector')?.value || 'None'}</p>
                `;
            }
            
            function updateSprintBoard() {
                const boardDiv = document.getElementById('sprint-board');
                const sprintId = app.currentSprint ? app.currentSprint.id : 
                    document.getElementById('sprint-selector')?.value;
                
                if (sprintId) {
                    const sprint = app.getSprint(sprintId);
                    const tasks = app.getFlatTasksForSprintBoard(sprintId);
                    
                    boardDiv.innerHTML = `
                        <h3>Sprint: ${sprint ? sprint.name : 'Unknown'}</h3>
                        <p>Total tasks: ${tasks.length}</p>
                        <div class="board-columns">
                            ${app.getBoardStatuses().map(status => {
                                const statusTasks = tasks.filter(task => task.status === status.id);
                                return `
                                    <div class="board-column">
                                        <div class="column-header">${status.name}</div>
                                        <div class="column-content">
                                            ${statusTasks.map(task => `
                                                <div class="task-item">
                                                    <div class="task-title">${task.title}</div>
                                                    <div class="task-meta">
                                                        Points: ${task.points}, Status: ${task.status}
                                                    </div>
                                                </div>
                                            `).join('') || '<div class="empty-state">No tasks</div>'}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } else {
                    boardDiv.innerHTML = '<p>No sprint selected</p>';
                }
            }
            
            // Run the test
            addResult('=== Starting Simple Sprint Test ===');
            
            // Clear any existing data
            app.tasks = [];
            app.sprints = [];
            app.saveData();
            
            // Step 1: Create a test sprint
            addResult('Step 1: Creating test sprint...');
            const sprint = app.createSprint({
                name: 'Test Sprint 1',
                startDate: '2025-01-01',
                endDate: '2025-01-14',
                duration: 14
            });
            addResult(`✓ Created sprint: ${sprint.name} (ID: ${sprint.id})`);
            
            // Step 2: Create a test task
            addResult('Step 2: Creating test task...');
            const task = app.createTask({
                title: 'Test Task for Sprint',
                description: 'This task should appear on the sprint board',
                points: 3,
                priority: 'medium'
            });
            addResult(`✓ Created task: ${task.title} (ID: ${task.id})`);
            
            // Update displays
            updateCurrentView();
            updateSprintBoard();
            
            // Step 3: Check initial state
            addResult('Step 3: Checking initial state...');
            const initialSprintTasks = app.getTasksBySprint(sprint.id);
            addResult(`Tasks in sprint initially: ${initialSprintTasks.length}`);
            
            // Step 4: Switch to board view
            addResult('Step 4: Switching to board view...');
            app.switchView('board');
            updateCurrentView();
            updateSprintBoard();
            
            // Step 5: Check if task appears on board
            addResult('Step 5: Checking if task appears on board...');
            const boardSprintId = app.currentSprint ? app.currentSprint.id : 
                document.getElementById('sprint-selector')?.value;
            
            if (boardSprintId === sprint.id) {
                addResult('✓ Correct sprint is selected on board');
            } else {
                addResult('✗ Wrong sprint selected on board', false);
            }
            
            // Step 6: Assign task to sprint
            addResult('Step 6: Assigning task to sprint...');
            app.assignTaskToSprint(task.id, sprint.id);
            addResult(`✓ Assigned task ${task.id} to sprint ${sprint.id}`);
            
            // Update displays
            updateCurrentView();
            updateSprintBoard();
            
            // Step 7: Check state after assignment
            addResult('Step 7: Checking state after assignment...');
            const afterSprintTasks = app.getTasksBySprint(sprint.id);
            addResult(`Tasks in sprint after assignment: ${afterSprintTasks.length}`);
            
            if (afterSprintTasks.length > 0) {
                addResult(`✓ Task found in sprint: ${afterSprintTasks[0].title}`);
            } else {
                addResult('✗ Task NOT found in sprint', false);
            }
            
            // Step 8: Check flat tasks for sprint board
            addResult('Step 8: Checking flat tasks for sprint board...');
            const flatTasks = app.getFlatTasksForSprintBoard(sprint.id);
            addResult(`Flat tasks for sprint board: ${flatTasks.length}`);
            
            if (flatTasks.length > 0) {
                addResult(`✓ Task found in flat list: ${flatTasks[0].title}`);
            } else {
                addResult('✗ Task NOT found in flat list', false);
            }
            
            // Step 9: Check if task appears on board
            addResult('Step 9: Checking if task appears on board...');
            const boardTasks = app.getFlatTasksForSprintBoard(boardSprintId);
            addResult(`Tasks on board: ${boardTasks.length}`);
            
            if (boardTasks.length > 0) {
                addResult(`✓ Task found on board: ${boardTasks[0].title}`);
            } else {
                addResult('✗ Task NOT found on board', false);
            }
            
            // Step 10: Check individual task status
            addResult('Step 10: Checking individual task status...');
            const individualTask = app.getTask(task.id);
            if (individualTask) {
                addResult(`✓ Task found: ${individualTask.title}`);
                addResult(`  - Sprint ID: ${individualTask.sprintId}`);
                addResult(`  - Status: ${individualTask.status}`);
                addResult(`  - Should appear on board: ${individualTask.sprintId === boardSprintId}`);
            } else {
                addResult('✗ Task NOT found', false);
            }
            
            addResult('=== Test Complete ===');
        });
    </script>
</body>
</html>